<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Absher Perfect Clone</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --absher-green: #006837;
            --light-green: #f3f8f6;
            --white: #ffffff;
            --gray-text: #6e6e6e;
            --border-color: #e2e8e6;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Arial, sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { background-color: var(--light-green); display: flex; justify-content: center; min-height: 100vh; }
        .app-container { width: 100%; max-width: 480px; background: var(--light-green); position: relative; }

        /* --- ১. লগইন ফ্লো স্ক্রিন --- */
        #login-flow-container { background: #ffffff; min-height: 100vh; padding: 15px 25px; display: flex; flex-direction: column; overflow-y: auto;}
        
        .login-header-nav { margin-bottom: 5px; text-align: left; }
        .back-btn-ui { font-size: 28px; color: #1b5e20; cursor: pointer; text-decoration: none; }

        .login-logo-area { display: flex; justify-content: center; margin: 15px 0; }
        .login-logo-area img { height: 90px; object-fit: contain; }

        #initial-login-view { text-align: center; }
        .welcome-title { font-size: 24px; font-weight: 800; color: #333; margin-bottom: 30px; }
        .btn-login-main { background: var(--absher-green); color: white; padding: 18px; border-radius: 12px; width: 100%; font-size: 18px; border: none; font-weight: 700; cursor: pointer; }

        #login-form { display: none; flex-direction: column; height: 100%; flex-grow: 1; }
        .login-title-new { text-align: center; font-size: 26px; font-weight: bold; color: #1a1a1a; margin-bottom: 25px; }
        
        .input-container-new { position: relative; margin-bottom: 18px; width: 100%; }
        .input-container-new label { position: absolute; top: 8px; left: 15px; font-size: 13px; color: #757575; pointer-events: none; }
        .input-field-new { width: 100%; padding: 26px 15px 10px 15px; font-size: 16px; border: 1.5px solid #e0e0e0; border-radius: 12px; outline: none; color: #333; background: #fff; }
        .input-field-new:focus { border-color: #00695c; }

        .options-row { display: flex; align-items: center; margin-bottom: 12px; }
        .checkbox-ui { width: 18px; height: 18px; margin-right: 10px; accent-color: #00695c; }
        .options-row label { font-size: 15px; color: #616161; }

        .info-section-ui { display: flex; gap: 10px; color: #616161; font-size: 13px; line-height: 1.4; margin-bottom: 30px; }
        .info-icon-ui { background: #1976d2; color: white; min-width: 18px; height: 18px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: bold; margin-top: 2px; }

        .footer-buttons-new { margin-top: auto; display: flex; flex-direction: column; gap: 15px; padding-bottom: 20px; }
        .login-btn-final { background-color: #84b09b; color: white; border: none; padding: 16px; border-radius: 12px; font-size: 18px; font-weight: 600; cursor: pointer; }
        .forgot-pass-new { text-align: center; color: #00695c; text-decoration: none; font-weight: 600; font-size: 16px; display: block; }

        .public-services-wrap { margin-top: 40px; text-align: left; }
        .public-title { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .public-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .public-box { background: var(--white); padding: 20px; border-radius: 18px; display: flex; flex-direction: column; gap: 10px; border: 1px solid #eee; }
        .public-box i { font-size: 30px; color: var(--absher-green); }
        .public-box span { font-weight: 700; font-size: 14.5px; color: #333; }

        /* --- ২. মেইন অ্যাপ কন্টেন্ট --- */
        #main-app-content { display: none; }
        .page-content { display: none; width: 100%; padding-bottom: 110px; }
        .page-content.active { display: block; }
        .shared-header { padding: 20px; background: var(--light-green); }
        .shared-title { font-size: 32px; font-weight: 800; color: #1a1a1a; margin: 10px 0 20px; }
        .search-bar-container { background: #e6ecea; border-radius: 12px; padding: 12px 15px; display: flex; align-items: center; gap: 10px; margin-bottom: 25px; }
        .search-bar-container i { color: #888; font-size: 20px; }
        .search-bar-container input { background: transparent; border: none; outline: none; font-size: 18px; color: #555; width: 100%; }
        .home-header { background: var(--white); padding: 10px 20px 25px; border-bottom: 1px solid var(--border-color); }
        .top-status { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .logo-box img { height: 40px; }
        .header-btns { color: var(--absher-green); display: flex; gap: 20px; font-size: 24px; }
        .profile-card-main { background: var(--white); border-radius: 16px; padding: 15px; display: flex; align-items: center; gap: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); cursor: pointer; border: 1px solid #f0f0f0; }
        .profile-card-main img { width: 65px; height: 65px; border-radius: 12px; object-fit: cover; }
        .profile-card-main h2 { font-size: 19px; font-weight: 700; color: #222; }
        .profile-card-main p { font-size: 14px; color: var(--gray-text); }
        .section-wrap { padding: 20px; }
        .flex-between { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .flex-between h3 { font-size: 20px; font-weight: 700; color: #1a1a1a; }
        .see-all-btn { color: var(--absher-green); text-decoration: none; font-weight: 600; cursor: pointer; }

        /* --- Resident ID Card Updated Style --- */
        .digital-doc {
    background: linear-gradient(135deg, #fff9e6 0%, #faecd1 100%);
    width: 155px;
    height: 100px;
    border-radius: 18px;
    position: relative; /* এটি লোগোকে কার্ডের ভেতর ধরে রাখবে */
    overflow: hidden; /* এটি লোগোর বাকি অংশ কেটে ফেলবে যাতে অরিজিনাল মনে হয় */
    border: 1.2px solid #efe0c5;
    padding: 12px;
    cursor: pointer;
}

.card-title {
    font-weight: 700;
    font-size: 16px;
    color: #333;
    position: relative;
    z-index: 2; /* টেক্সট যেন লোগোর উপরে থাকে */
}

.card-watermark {
    position: absolute;
    right: -25px; /* এটি লোগোকে ডান দিকে সরিয়ে দেবে */
    bottom: -30px; /* এটি লোগোকে নিচের দিকে নামিয়ে দেবে */
    width: 120px; /* লোগোর আকার অরিজিনালের মতো বড় হবে */
    opacity: 0.15; /* ওয়াটারমার্ক ইফেক্ট দেওয়ার জন্য অপাসিটি কমানো হয়েছে */
    pointer-events: none;
    transform: rotate(-10deg); /* হালকা বাঁকানো লুকের জন্য */
}


        .info-note { display: flex; gap: 10px; margin-top: 15px; color: #5d6d66; font-size: 13px; line-height: 1.4; }
        .info-note i { color: #1976d2; font-size: 16px; }
        .vehicle-card { background: var(--white); padding: 20px; border-radius: 18px; display: flex; align-items: center; gap: 18px; margin-bottom: 15px; }
        .vehicle-card i { font-size: 38px; color: var(--absher-green); }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .service-box { background: var(--white); padding: 22px; border-radius: 18px; display: flex; flex-direction: column; gap: 12px; cursor: pointer; }
        .service-box i { font-size: 34px; color: var(--absher-green); }
        .service-box span { font-weight: 700; font-size: 15.5px; color: #222; }
        .services-grid-new { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 0 20px; }
        .service-card-new { background: var(--white); border-radius: 15px; padding: 20px; min-height: 140px; display: flex; flex-direction: column; justify-content: flex-start; gap: 15px; border: 1px solid #f0f0f0; }
        .service-card-new i { font-size: 32px; color: var(--absher-green); }
        .service-card-new span { font-size: 16px; font-weight: 700; color: #333; line-height: 1.2; }
        .empty-state-container { text-align: center; padding: 60px 20px; color: #333; }
        .empty-state-container i.main-icon { font-size: 80px; color: #6e6e6e; margin-bottom: 30px; display: block; opacity: 0.5; }
        .empty-state-container h2 { font-size: 24px; font-weight: 700; margin-bottom: 10px; }
        .empty-state-container p { font-size: 16px; color: #7a7a7a; line-height: 1.5; max-width: 280px; margin: 0 auto; }

        #profile-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--light-green); z-index: 2000; display: none; overflow-y: auto; }
        .overlay-header { background: var(--white); margin: 65px 18px 20px; border-radius: 22px; padding: 55px 15px 25px; text-align: center; position: relative; }
        .float-user-img { width: 95px; height: 95px; border-radius: 16px; position: absolute; top: -47px; left: 50%; transform: translateX(-50%); border: 4px solid var(--white); object-fit: cover; box-shadow: 0 6px 15px rgba(0,0,0,0.12); }
        .back-icon { position: absolute; top: -45px; left: 0; color: var(--absher-green); font-size: 28px; cursor: pointer; padding: 5px; }
        .row-item { background: var(--white); margin: 0 18px 15px; padding: 22px; border-radius: 18px; display: flex; align-items: center; gap: 18px; cursor: pointer; }
        .row-item i { font-size: 30px; color: var(--absher-green); width: 35px; text-align: center; }
        .row-item span { font-weight: 700; font-size: 17px; }
        .banner-travel { margin: 0 18px 15px; height: 150px; border-radius: 20px; background: linear-gradient(to right, rgba(0,104,55,0.85), rgba(0,148,68,0.7)), url('https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?q=80&w=500&auto=format&fit=crop'); background-size: cover; color: var(--white); padding: 22px; display: flex; flex-direction: column; justify-content: flex-end; position: relative; }
        .status-pill { position: absolute; top: 18px; right: 18px; background: rgba(255,255,255,0.95); color: #333; padding: 5px 14px; border-radius: 25px; font-size: 12px; font-weight: 800; }

        .detail-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--light-green); z-index: 3000; display: none; overflow-y: auto; padding-bottom: 100px; }
        .detail-header-new { background: var(--white); padding: 45px 15px 15px; display: flex; align-items: center; gap: 20px; }
        .detail-header-new i { font-size: 22px; color: var(--absher-green); cursor: pointer; }
        .detail-header-new h2 { font-size: 21px; font-weight: 600; color: #333; }
        .amount-card { background: var(--white); margin: 15px; padding: 18px; border-radius: 12px; border: 1px solid var(--border-color); }
        .amount-card p { font-size: 14px; color: #333; font-weight: 600; margin-bottom: 5px; }
        .amount-card h4 { font-size: 17px; color: var(--gray-text); font-weight: 500; }
        .info-container-main { background: var(--white); margin: 15px; border-radius: 12px; border: 1px solid var(--border-color); overflow: hidden; }
        .info-card-header { padding: 20px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #f2f2f2; }
        .info-card-header .left-side { display: flex; align-items: center; gap: 15px; }
        .info-card-header i { font-size: 28px; color: var(--gray-text); }
        .info-card-header span { font-size: 19px; font-weight: 700; color: #222; }
        .info-content-body { padding: 20px; }
        .data-group { margin-bottom: 25px; position: relative; }
        .data-group:last-child { margin-bottom: 0; }
        .data-label { font-size: 14px; color: #333; font-weight: 600; margin-bottom: 6px; display: block; }
        .data-value { font-size: 16px; color: var(--gray-text); font-weight: 500; display: block; }
        .copy-icon-btn { position: absolute; right: 0; top: 10px; color: var(--absher-green); font-size: 18px; }

        #see-all-page { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fdfdfd; z-index: 4500; display: none; overflow-y: auto; }
        .see-all-header { background: white; padding: 45px 15px 15px; display: flex; align-items: center; gap: 20px; border-bottom: 1px solid #eee; }
        .see-all-content { padding: 20px; text-align: center; }
        .update-info { color: #888; font-size: 13px; margin-bottom: 30px; line-height: 1.5; }
        .resident-id-title { text-align: left; font-size: 22px; font-weight: 800; color: #222; margin-bottom: 20px; }
        .main-card-img { width: 100%; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }

        #digital-id-viewer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #333333; z-index: 5000; display: none; overflow-y: auto; }
        .viewer-header { padding: 20px; position: sticky; top: 0; z-index: 10; }
        .viewer-header i { color: white; font-size: 28px; cursor: pointer; }
        .viewer-content { display: flex; flex-direction: column; align-items: center; padding: 0 15px 150px; }
        .id-card-img-landscape, .qr-card-img-scroll { width: 145%; max-width: none; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); transform: rotate(90deg); margin-top: 130px; margin-bottom: 130px; }

        .bottom-nav { position: fixed; bottom: 0; width: 100%; max-width: 480px; background: var(--white); display: flex; justify-content: space-around; padding: 12px 0 28px; border-top: 1px solid var(--border-color); z-index: 4000; }
        .nav-item { text-align: center; color: #9da8a4; text-decoration: none; font-size: 11px; font-weight: 700; flex: 1; border: none; background: none; cursor: pointer; transition: 0.3s; }
        .nav-item i { font-size: 22px; margin-bottom: 6px; display: block; }
        .nav-item.active { color: var(--absher-green); }
        .fab-msg { position: fixed; bottom: 105px; right: 20px; background: #004d30; color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 26px; box-shadow: 0 5px 15px rgba(0,0,0,0.25); z-index: 1000; }
    </style>
</head>
<body>

    <div class="app-container">
        <div id="login-flow-container">
            <div class="login-header-nav">
                <span class="back-btn-ui" onclick="location.reload()">←</span>
            </div>
            
            <div class="login-logo-area">
                <img src="https://i.postimg.cc/3Jphft4m/Picsart-25-12-26-13-57-11-843.png" alt="Logo">
            </div>

            <div id="initial-login-view">
                <h1 class="welcome-title">Absher E-Services 24/7</h1>
                <button class="btn-login-main" onclick="showLoginForm()">Log In</button>
                <div class="public-services-wrap">
                    <div class="public-title"><h3>Public Services</h3><span style="color:var(--absher-green); font-weight:700;">See All</span></div>
                    <div class="public-grid">
                        <div class="public-box"><i class="fa-solid fa-fingerprint"></i><span>Authentication Services</span></div>
                        <div class="public-box"><i class="fa-solid fa-calendar-check"></i><span>Appointments</span></div>
                        <div class="public-box"><i class="fa-solid fa-file-circle-question"></i><span>General Queries</span></div>
                        <div class="public-box"><i class="fa-solid fa-qrcode"></i><span>View Digital Documents</span></div>
                    </div>
                </div>
            </div>

            <div id="login-form">
                <div class="login-title-new">Log In to Absher</div>
                
                <div class="input-container-new">
                    <label>Username or ID Number</label>
                    <input type="text" id="akamaId" class="input-field-new" placeholder="Enter Username or ID Number">
                </div>

                <div class="input-container-new">
                    <label>Password</label>
                    <input type="password" id="loginPassword" class="input-field-new" placeholder="Enter Password">
                </div>

                <div class="options-row">
                    <input type="checkbox" id="keep" class="checkbox-ui">
                    <label for="keep">Keep me logged in</label>
                </div>

                <div class="info-section-ui">
                    <div class="info-icon-ui">i</div>
                    <p>Enable biometrics use on your Settings to be able to check the option to stay logged in</p>
                </div>

                <div class="footer-buttons-new">
                    <button class="login-btn-final" id="loginBtn" onclick="handleSecureLogin()">Log In</button>
                    <a href="#" class="forgot-pass-new">Forgot Password</a>
                </div>
            </div>
        </div>

        <div id="main-app-content">
            <div id="home-page" class="page-content active">
                <header class="home-header">
                    <div class="top-status">
                        <div class="logo-box"><img src="https://i.postimg.cc/3Jphft4m/Picsart-25-12-26-13-57-11-843.png"></div>
                        <div class="header-btns"><i class="fa-solid fa-gear"></i><i class="fa-solid fa-bell"></i></div>
                    </div>
                    <div class="profile-card-main" onclick="toggleProfile(true)">
                        <img src="" id="user-img-main">
                        <div class="profile-text"><h2 id="user-name-main">Loading...</h2><p id="user-id-main">ID No.: ---</p></div>
                    </div>
                </header>
                <div class="section-wrap">
                    <div class="flex-between"><h3>My Digital Documents</h3><a href="#" class="see-all-btn" onclick="openSeeAllPage()">See All</a></div>
                    
                    <div class="digital-doc-container">
                        <div class="digital-doc" onclick="openDigitalID()">
    <span class="card-title">Resident ID</span>
    <img src="https://i.postimg.cc/pT7NBXbg/Picsart-26-01-20-05-25-13-991.png" class="card-watermark">
</div>

                    </div>

                    <div class="info-note"><i class="fa-solid fa-circle-info"></i><p>Your most relevant documents. Tap See All to see the rest of your documents and your family members'.</p></div>
                </div>
                <div class="section-wrap">
                    <h3 style="margin-bottom: 18px;">Quick Access</h3>
                    <div class="vehicle-card"><i class="fa-solid fa-car-side"></i><div><h4>My Vehicles</h4><p>View details, renew documents, and more.</p></div></div>
                    <div class="grid-2">
                        <div class="service-box"><i class="fa-solid fa-fingerprint"></i><span>Authentication Services</span></div>
                        <div class="service-box"><i class="fa-solid fa-map-location-dot"></i><span>Absher Travel</span></div>
                        <div class="service-box"><i class="fa-solid fa-car-burst"></i><span>Report Accident</span></div>
                        <div class="service-box"><i class="fa-solid fa-file-circle-exclamation"></i><span>Traffic Violations</span></div>
                    </div>
                </div>
            </div>

            <div id="my-services-page" class="page-content">
                <div class="shared-header">
                    <div class="top-status"><div class="logo-box"><img src="https://upload.wikimedia.org/wikipedia/en/thumb/4/4b/Saudi_Arabia_Coat_of_arms.svg/1200px-Saudi_Arabia_Coat_of_arms.svg.png"></div><div class="header-btns"><i class="fa-solid fa-gear"></i><i class="fa-solid fa-bell"></i></div></div>
                    <h1 class="shared-title">My Services</h1>
                    <div class="search-bar-container"><i class="fa-solid fa-magnifying-glass"></i><input type="text" placeholder="Search by Service..."></div>
                </div>
                <div class="services-grid-new">
                    <div class="service-card-new"><i class="fa-solid fa-baby"></i><span>Register Newborn</span></div>
                    <div class="service-card-new"><i class="fa-solid fa-address-card"></i><span>Renew Driving License</span></div>
                    <div class="service-card-new"><i class="fa-solid fa-id-card"></i><span>Renew Resident ID</span></div>
                    <div class="service-card-new"><i class="fa-solid fa-fingerprint"></i><span>Authentication Services</span></div>
                    <div class="service-card-new"><i class="fa-solid fa-images"></i><span>Change Resident Photo</span></div>
                    <div class="service-card-new"><i class="fa-solid fa-car-on"></i><span>Report Minor Accident</span></div>
                </div>
            </div>

            <div id="family-page" class="page-content">
                <div class="shared-header"><h1 class="shared-title">Family Members</h1></div>
                <div class="empty-state-container"><i class="fa-solid fa-users main-icon"></i><h2>No Family Members</h2><p>You haven't added any family members yet.</p></div>
            </div>

            <div id="workers-page" class="page-content">
                <div class="shared-header"><h1 class="shared-title">Workers</h1></div>
                <div class="empty-state-container"><i class="fa-solid fa-briefcase main-icon"></i><h2>No Workers</h2><p>There are no workers registered under your ID.</p></div>
            </div>

            <div id="see-all-page">
                <div class="see-all-header"><i class="fa-solid fa-arrow-left" style="color:var(--absher-green); font-size:24px; cursor:pointer;" onclick="closeSeeAllPage()"></i><h2 style="font-size:20px;">Digital Documents</h2></div>
                <div class="see-all-content">
                    <p class="update-info" id="last-update-text">Pull to update.</p>
                    <h3 class="resident-id-title">Resident ID</h3>
                    <img src="" id="main-card-display" class="main-card-img">
                </div>
            </div>

            <div id="digital-id-viewer">
                <div class="viewer-header"><i class="fa-solid fa-xmark" onclick="closeDigitalID()"></i></div>
                <div class="viewer-content">
                    <img src="" class="id-card-img-landscape" id="id-img-view">
                    <img src="" class="qr-card-img-scroll" id="qr-img-view">
                </div>
            </div>

            <div id="profile-overlay">
                <div class="overlay-header">
                    <i class="fa-solid fa-arrow-left back-icon" onclick="toggleProfile(false)"></i>
                    <img src="" class="float-user-img" id="user-img-overlay">
                    <h2 id="user-name-overlay">---</h2><p>ID No. <span id="user-id-overlay">---</span> <i class="fa-regular fa-copy"></i></p>
                    <a href="#" onclick="showDetail('personal')" style="color:var(--absher-green); text-decoration:none; font-weight:700; display:block; margin-top:15px;">My Personal Details ></a>
                </div>
                <div class="grid-2" style="padding: 0 18px 15px;">
                    <div class="service-box" onclick="showDetail('passport')"><i class="fa-solid fa-passport"></i><span>My Passport</span></div>
                    <div class="service-box" onclick="showDetail('resident')"><i class="fa-solid fa-id-card-clip"></i><span>My Resident ID</span></div>
                </div>
                <div class="row-item" onclick="showDetail('visa')"><i class="fa-solid fa-file-invoice"></i><span>My Visa</span></div>
                <div class="row-item"><i class="fa-solid fa-id-card"></i><span>My Driving License</span></div>
                <div class="banner-travel"><div class="status-pill">Inside Kingdom</div><h3>My Travel Records</h3><p>Find your last trips details</p></div>
                <div class="row-item" style="margin-bottom: 120px;"><i class="fa-solid fa-users-gear"></i><span>Labor Importations</span></div>
            </div>

            <div id="passport-detail" class="detail-screen">
                <div class="detail-header-new"><i class="fa-solid fa-arrow-left" onclick="hideDetail('passport-detail')"></i><h2>My Passport</h2></div>
                <div class="amount-card"><p>Amount deposit</p><h4 id="pass-deposit">SAR 0.00</h4></div>
                <div class="info-container-main">
                    <div class="info-card-header"><div class="left-side"><i class="fa-solid fa-passport"></i><span>Normal Passport</span></div><i class="fa-solid fa-chevron-up" style="font-size: 16px;"></i></div>
                    <div class="info-content-body">
                        <div class="data-group"><span class="data-label">Passport Number</span><span class="data-value" id="pass-num">---</span></div>
                        <div class="data-group"><span class="data-label">Type</span><span class="data-value" id="pass-type">Normal</span></div>
                        <div class="data-group"><span class="data-label">Issuing Date</span><span class="data-value" id="pass-issue-date">---</span></div>
                        <div class="data-group"><span class="data-label">Expiry Date</span><span class="data-value" id="pass-expiry-date">---</span></div>
                        <div class="data-group"><span class="data-label">Issuing City</span><span class="data-value" id="pass-city">---</span></div>
                    </div>
                </div>
            </div>

            <div id="resident-detail" class="detail-screen">
                <div class="detail-header-new"><i class="fa-solid fa-arrow-left" onclick="hideDetail('resident-detail')"></i><h2>My Resident ID</h2></div>
                <div class="info-container-main" style="margin-top: 25px;">
                    <div class="info-card-header" style="border-bottom: none;"><div class="left-side"><i class="fa-solid fa-id-card"></i><span>My Resident ID</span></div></div>
                    <div class="info-content-body" style="padding-top: 0;">
                        <div class="data-group"><span class="data-label">Resident ID Number</span><span class="data-value" id="res-id-val">---</span></div>
                        <div class="data-group"><span class="data-label">ID Version</span><span class="data-value" id="res-ver">1</span></div>
                        <div class="data-group"><span class="data-label">Issuing Date</span><span class="data-value" id="res-iss-date">---</span></div>
                        <div class="data-group"><span class="data-label">Expiry Date</span><span class="data-value" id="res-exp-date">---</span></div>
                    </div>
                </div>
            </div>

            <div id="visa-detail" class="detail-screen">
                <div class="detail-header-new"><i class="fa-solid fa-arrow-left" onclick="hideDetail('visa-detail')"></i><h2>My Visa</h2></div>
                <div class="info-container-main" style="margin-top: 20px; border: none; background: transparent;">
                    <div class="amount-card" style="background: white; border: 1px solid var(--border-color); border-radius: 12px; margin: 0 0 15px 0; padding: 15px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <i class="fa-solid fa-file-lines" style="font-size: 26px; color: #6e6e6e;"></i>
                            <span style="font-size: 19px; font-weight: 700; color: #222;">My Visa</span>
                        </div>
                    </div>
                    <div class="info-container-main" style="margin: 0; border: 1px solid var(--border-color); background: white; border-radius: 12px;">
                        <div class="info-content-body" style="padding: 15px;">
                            <div class="data-group" style="margin-bottom: 20px;">
                                <span class="data-label" style="font-size: 13px;">Visa Number</span>
                                <span class="data-value" id="v-num" style="font-size: 16px; color: #333; font-weight: 600;">---</span>
                                <i class="fa-regular fa-copy copy-icon-btn" style="font-size: 16px; top: 5px;"></i>
                            </div>
                            <div class="data-group" style="margin-bottom: 20px;">
                                <span class="data-label" style="font-size: 13px;">Visa Type</span>
                                <span class="data-value" id="v-type" style="font-size: 16px; color: #333; font-weight: 600;">---</span>
                            </div>
                            <div class="data-group" style="margin-bottom: 20px;">
                                <span class="data-label" style="font-size: 13px;">Exit from KSA before</span>
                                <span class="data-value" id="v-exit" style="font-size: 16px; color: #333; font-weight: 600;">---</span>
                            </div>
                            <div class="data-group">
                                <span class="data-label" style="font-size: 13px;">Return before</span>
                                <span class="data-value" id="v-return" style="font-size: 16px; color: #333; font-weight: 600;">---</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="personal-details-screen" class="detail-screen">
                <div class="detail-header-new">
                    <i class="fa-solid fa-arrow-left" onclick="hideDetail('personal-details-screen')"></i>
                    <h2>My Personal Details</h2>
                </div>
                <div style="background: white; margin: 15px 15px 0 15px; padding: 15px; border-radius: 12px 12px 0 0; display: flex; align-items: center; gap: 15px; border: 1px solid var(--border-color); border-bottom: none;">
                    <img src="" id="det-profile-img" style="width: 50px; height: 50px; border-radius: 8px; object-fit: cover; border: 1px solid #eee;">
                    <span style="font-size: 17px; font-weight: 700; color: #333;">Personal Details</span>
                </div>
                <div class="info-container-main" style="margin-top: 0; border-radius: 0 0 12px 12px; border-top: 1px solid #f2f2f2; margin-bottom: 10px;">
                    <div class="info-content-body">
                        <div class="data-group"><span class="data-label">Name</span><span class="data-value" id="det-name">---</span></div>
                        <div class="data-group"><span class="data-label">Birth City</span><span class="data-value" id="det-city">-</span></div>
                        <div class="data-group"><span class="data-label">Birth Country/Region</span><span class="data-value" id="det-country">Bangladesh</span></div>
                        <div class="data-group"><span class="data-label">Date of Birth</span><span class="data-value" id="det-dob">---</span></div>
                        <div class="data-group"><span class="data-label">Marital Status</span><span class="data-value" id="det-marital">SINGLE</span></div>
                        <div class="data-group"><span class="data-label">No. of sponsorship transfers</span><span class="data-value" id="det-transfers">0</span></div>
                        <div class="data-group"><span class="data-label">Religion</span><span class="data-value" id="det-religion">Islam</span></div>
                        <div class="data-group"><span class="data-label">Work Permit</span><span class="data-value" id="det-permit">-</span></div>
                        <div class="data-group"><span class="data-label">Biometrics Collected</span><span class="data-value" id="det-bio">Yes</span></div>
                        <div class="data-group"><span class="data-label">Travel Status</span><span class="data-value" id="det-travel">Inside</span></div>
                    </div>
                </div>

                <div style="margin: 0 15px;">
                    <div onclick="toggleAccordion('sp-cont', 'sp-ico')">
                        <div style="display: flex; justify-content: space-between; align-items: center; background: white; padding: 18px 15px; border-radius: 12px; border: 1px solid var(--border-color); margin-bottom: 10px;">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <i class="fa-regular fa-user" style="font-size: 20px; color: #6e6e6e;"></i>
                                <span style="font-weight: 700; color: #333;">Sponsor Details</span>
                            </div>
                            <i class="fa-solid fa-chevron-down" id="sp-ico" style="color: #ccc; transition: 0.3s;"></i>
                        </div>
                        <div id="sp-cont" style="display: none; background: white; margin-top: -10px; margin-bottom: 10px; padding: 15px; border: 1px solid var(--border-color); border-top: none; border-radius: 0 0 12px 12px;">
                            <div class="data-group"><span class="data-label">Sponsor Name</span><span class="data-value" id="det-sp-name">---</span></div>
                            <div class="data-group"><span class="data-label">Sponsor ID</span><span class="data-value" id="det-sp-id">---</span></div>
                        </div>
                    </div>

                    <div onclick="toggleAccordion('he-cont', 'he-ico')">
                        <div style="display: flex; justify-content: space-between; align-items: center; background: white; padding: 18px 15px; border-radius: 12px; border: 1px solid var(--border-color); margin-bottom: 10px;">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <i class="fa-solid fa-moon" style="font-size: 20px; color: #6e6e6e;"></i>
                                <span style="font-weight: 700; color: #333;">Health Insurance</span>
                            </div>
                            <i class="fa-solid fa-chevron-down" id="he-ico" style="color: #ccc; transition: 0.3s;"></i>
                        </div>
                        <div id="he-cont" style="display: none; background: white; margin-top: -10px; margin-bottom: 10px; padding: 15px; border: 1px solid var(--border-color); border-top: none; border-radius: 0 0 12px 12px;">
                            <div class="data-group"><span class="data-label">Issuing Date</span><span class="data-value" id="det-ins-issue">---</span></div>
                            <div class="data-group"><span class="data-label">Expiry Date</span><span class="data-value" id="det-ins-exp">---</span></div>
                            <div class="data-group"><span class="data-label">Blood Type</span><span class="data-value" id="det-blood">-</span></div>
                        </div>
                    </div>

                    <div onclick="toggleAccordion('hj-cont', 'hj-ico')">
                        <div style="display: flex; justify-content: space-between; align-items: center; background: white; padding: 18px 15px; border-radius: 12px; border: 1px solid var(--border-color); margin-bottom: 10px;">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <i class="fa-solid fa-kaaba" style="font-size: 20px; color: #6e6e6e;"></i>
                                <span style="font-weight: 700; color: #333;">Hajj Details</span>
                            </div>
                            <i class="fa-solid fa-chevron-down" id="hj-ico" style="color: #ccc; transition: 0.3s;"></i>
                        </div>
                        <div id="hj-cont" style="display: none; background: white; margin-top: -10px; margin-bottom: 10px; padding: 15px; border: 1px solid var(--border-color); border-top: none; border-radius: 0 0 12px 12px;">
                            <p style="font-size: 14px; color: #999;">No Hajj records found.</p>
                        </div>
                    </div>
                </div>
            </div>

            <nav class="bottom-nav">
                <button onclick="switchTab('home-page', this)" class="nav-item active"><i class="fa-solid fa-house-chimney"></i>Home</button>
                <button onclick="switchTab('my-services-page', this)" class="nav-item"><i class="fa-regular fa-id-badge"></i>My Services</button>
                <button onclick="switchTab('family-page', this)" class="nav-item"><i class="fa-solid fa-users-viewfinder"></i>Family</button>
                <button onclick="switchTab('workers-page', this)" class="nav-item"><i class="fa-solid fa-briefcase"></i>Workers</button>
                <button class="nav-item"><i class="fa-solid fa-table-cells-large"></i>Other</button>
            </nav>
            <div class="fab-msg"><i class="fa-solid fa-comment-dots"></i></div>
        </div>
    </div>

    <script>
        const S_URL = 'https://ztntvqvzlftaigwvioai.supabase.co';
        const S_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp0bnR2cXZ6bGZ0YWlnd3Zpb2FpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg4NDg4NTMsImV4cCI6MjA4NDQyNDg1M30.BjTeMkbUGwCk9FfrwmEgWmr0TEff-O2xHkBm-Q6CmJo';
        const _supabase = supabase.createClient(S_URL, S_KEY);

        function toggleAccordion(contId, icoId) {
            const cont = document.getElementById(contId);
            const ico = document.getElementById(icoId);
            if (cont.style.display === "none") {
                cont.style.display = "block";
                ico.style.transform = "rotate(180deg)";
            } else {
                cont.style.display = "none";
                ico.style.transform = "rotate(0deg)";
            }
        }

        async function handleSecureLogin() {
            const idInput = document.getElementById('akamaId').value;
            const passInput = document.getElementById('loginPassword').value;
            const loginBtn = document.getElementById('loginBtn');
            if(!idInput || !passInput) { alert("Please fill all fields"); return; }
            loginBtn.innerText = "Verifying...";
            const { data, error } = await _supabase.from('profiles').select('*').eq('id_number', idInput).eq('password', passInput).single();
            if (error || !data) { alert("Invalid ID or Password! Access Denied."); loginBtn.innerText = "Log In"; } 
            else { setUserData(data); startApp(); }
        }

        function updateLastUpdateDate() {
            const now = new Date();
            const options = { weekday: 'long', day: '2-digit', month: 'long', year: 'numeric', hour: 'numeric', minute: '2-digit', hour12: true };
            const formattedDate = now.toLocaleString('en-GB', options);
            document.getElementById('last-update-text').innerHTML = `Last updated: ${formattedDate} <br> Pull to update.`;
        }

        function setUserData(data) {
            document.getElementById('user-name-main').innerText = data.full_name;
            document.getElementById('user-name-overlay').innerText = data.full_name;
            document.getElementById('user-id-main').innerText = "ID No.: " + data.id_number;
            document.getElementById('user-id-overlay').innerText = data.id_number;
            document.getElementById('user-img-main').src = data.profile_pic_url;
            document.getElementById('user-img-overlay').src = data.profile_pic_url;
            document.getElementById('res-id-val').innerText = data.id_number;
            document.getElementById('res-ver').innerText = data.res_version;
            document.getElementById('res-iss-date').innerText = data.res_issue_date;
            document.getElementById('res-exp-date').innerText = data.res_expiry_date;
            document.getElementById('pass-deposit').innerText = data.pass_amount;
            document.getElementById('pass-num').innerText = data.pass_num;
            document.getElementById('pass-issue-date').innerText = data.pass_issue_date;
            document.getElementById('pass-expiry-date').innerText = data.pass_expiry_date;
            document.getElementById('pass-city').innerText = data.pass_issue_city;
            document.getElementById('main-card-display').src = data.id_card_image;
            document.getElementById('id-img-view').src = data.id_card_image;
            document.getElementById('qr-img-view').src = data.qr_card_image;
            document.getElementById('v-num').innerText = data.visa_num || '---';
            document.getElementById('v-type').innerText = data.visa_type || '---';
            document.getElementById('v-exit').innerText = data.visa_exit_before || '---';
            document.getElementById('v-return').innerText = data.visa_return_date || '---';
            document.getElementById('det-profile-img').src = data.profile_pic_url;
            document.getElementById('det-name').innerText = data.full_name;
            document.getElementById('det-city').innerText = data.birth_city || '-';
            document.getElementById('det-country').innerText = data.birth_country || 'Bangladesh';
            document.getElementById('det-dob').innerText = data.date_of_birth || '---';
            document.getElementById('det-marital').innerText = data.marital_status || 'SINGLE';
            document.getElementById('det-transfers').innerText = data.sponsorship_transfers || '0';
            document.getElementById('det-religion').innerText = data.religion || 'Islam';
            document.getElementById('det-permit').innerText = data.work_permit || '-';
            document.getElementById('det-bio').innerText = data.biometrics_collected || 'Yes';
            document.getElementById('det-travel').innerText = data.travel_status || 'Inside';
            document.getElementById('det-sp-name').innerText = data.sponsor_name || '---';
            document.getElementById('det-sp-id').innerText = data.sponsor_id || '---';
            document.getElementById('det-ins-issue').innerText = data.ins_issue_date || '---';
            document.getElementById('det-ins-exp').innerText = data.ins_expiry_date || '---';
            document.getElementById('det-blood').innerText = data.blood_type || '-';
            updateLastUpdateDate();
        }

        function showLoginForm() { 
            document.getElementById('initial-login-view').style.display = 'none'; 
            document.getElementById('login-form').style.display = 'flex'; 
        }
        function startApp() { 
            document.getElementById('login-flow-container').style.display = 'none'; 
            document.getElementById('main-app-content').style.display = 'block'; 
        }
        function toggleProfile(show) { document.getElementById('profile-overlay').style.display = show ? 'block' : 'none'; }
        function showDetail(type) { 
            if(type === 'passport') document.getElementById('passport-detail').style.display = 'block'; 
            if(type === 'resident') document.getElementById('resident-detail').style.display = 'block'; 
            if(type === 'visa') document.getElementById('visa-detail').style.display = 'block';
            if(type === 'personal') document.getElementById('personal-details-screen').style.display = 'block';
        }
        function hideDetail(id) { document.getElementById(id).style.display = 'none'; }
        function openSeeAllPage() { document.getElementById('see-all-page').style.display = 'block'; }
        function closeSeeAllPage() { document.getElementById('see-all-page').style.display = 'none'; }
        function openDigitalID() { document.getElementById('digital-id-viewer').style.display = 'block'; document.body.style.overflow = 'hidden'; }
        function closeDigitalID() { document.getElementById('digital-id-viewer').style.display = 'none'; document.body.style.overflow = 'auto'; }
        function switchTab(tabId, element) {
            document.querySelectorAll('.page-content').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            element.classList.add('active');
            toggleProfile(false);
            hideDetail('passport-detail'); hideDetail('resident-detail'); hideDetail('visa-detail'); hideDetail('personal-details-screen');
            closeDigitalID(); closeSeeAllPage();
        }
    </script>
</body>
</html>
